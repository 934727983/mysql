# 容灾集群 {#concept_vpf_m2f_z2b .concept}

## 什么是容灾集群 {#section_nf5_42f_z2b .section}

全球数据库容灾集群（Global Database Replica Cluster）是阿里云推出的一款具备跨地域（Region）容灾能力的云数据库解决方案，基于阿里巴巴多年的容灾和多活建设经验，让您可以快速复制大型互联网公司的容灾能力，比如两地三中心。

容灾集群由一个主实例和至少一个异地灾备实例组成（暂时仅支持一个灾备实例），主实例支持读写，对外提供服务，灾备实例为只读，仅可用于查询。主实例实时地同步数据到灾备实例（秒级延时）。

**费用**：全球容灾能力目前0折优惠，您只需为使用的RDS实例付费。

**支持的实例类型**：MySQL 5.6（即将支持MySQL 5.7）

**支持的地域**：华东1（杭州）、华东2（上海）、华北1（青岛）、华北2（北京）、华南1（深圳）、中国（香港）、美西1（硅谷）、美西2（弗吉尼亚）

 ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609411272_zh-CN.png)

## 优势 {#section_qlx_y2f_z2b .section}

**简单易用，透明切换**

-   可以基于一个正在使用的RDS实例，一键式构建容灾集群，而且对该实例的运行没有任何影响。
-   切换过程对上层应用透明，不需要修改应用端的数据库连接地址。

 ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609511274_zh-CN.png) 

**安全可靠，数据0丢失**

-   通过异地灾备数据库实现跨地域的容灾，提高数据安全等级，让您的核心数据全球在线。
-   对于计划内的切换，灾备实例只有在接收并应用全部日志后才接替主实例，因此确保不会造成数据丢失。

## 异地灾备实例 {#section_czc_qff_z2b .section}

主实例的规格、存储空间、系列、网络类型的变更不会同步到灾备实例。

主实例的数据库账号、白名单、实例参数、数据的变更会同步到灾备实例。

|项目|说明|
|--|--|
|地域|与主实例不同。|
|规格（CPU、内存）|大于、等于或小于主实例的规格。|
|存储空间|大于或等于主实例的存储空间。|
|引擎类型、引擎版本、实例系列、网络类型、数据库账号、白名单、实例参数|与主实例相同，且无法修改。|
|连接地址|独立于主实例，且允许修改。|
|数据|只能读取，不支持写入。将业务切换到灾备实例后，由灾备实例提供服务，则灾备实例支持读写操作。|

## 连接地址 {#section_gth_5mh_1fb .section}

-   集群连接地址（推荐使用）：支持读写操作，总是连接到集群中提供服务的实例。容灾切换前后，集群连接地址保持不变。
-   主实例连接地址：主实例提供服务时，用于连接到主实例，支持读写操作。灾备实例提供服务时，无法连接到主实例。
-   灾备实例连接地址：主实例提供服务时，用于连接到灾备实例，仅支持读操作。灾备实例提供服务时，灾备实例连接地址变为与集群连接地址相同，支持读写操作。

## 创建容灾集群 {#section_f2r_lmf_z2b .section}

容灾集群是通过创建异地灾备实例来实现的。具体操作如下：

1.  登录[RDS管理控制台](http://rdsnext.console.aliyun.com)。
2.  选择**容灾集群**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609511231_zh-CN.png)

3.  单击**创建灾备**。
4.  在弹出的对话框中，选择主实例所在的地域和主实例。

    **说明：** 选择的主实例不能是灾备实例，或者已经绑定灾备实例的实例。

5.  设置灾备实例的参数。

    |参数|说明|
    |--|--|
    |地域| 地域是指实例所在的地理位置。购买后无法更换地域。

 系统只显示与主实例不同的地域。|
    |可用区|可用区是地域中的一个独立物理区域，不同可用区之间没有实质性区别。 **多可用区**：部分地域还支持多可用区，也就是将实例的主备节点不属于不同的可用区，实现更高的容灾能力。多可用区功能没有额外收费。

 |
    |规格|可以选择大于、等于或小于主实例的规格。 每种规格都有对应的CPU核数、内存、最大连接数和最大IOPS。具体请参见[实例规格表](../../../../cn.zh-CN/云数据库RDS简介/实例规格/实例规格表.md)。

 RDS实例有以下规格族：

    -   通用型：独享被分配的内存和I/O资源，与同一服务器上的其他通用型实例共享CPU和存储资源。
    -   独享型：独享被分配的CPU、内存、存储和I/O资源。
    -   独占物理机型：是独享型的顶配，独占整台服务器的CPU、内存、存储和I/O资源。
 例如，**8核32GB**是通用型实例规格，**8核32GB（独享套餐）**是独享型实例规格，**30核220GB（独占主机）**是独占物理机型实例规格。

 |
    |存储空间|必须大于或等于主实例的存储空间。|
    |购买时长|对于包年包月实例，您还需要设置购买时长，且时间越长，折扣越大。|
    |数量|目前每个集群仅支持一个灾备实例。|

    **说明：** 灾备实例的引擎类型、引擎版本、实例系列、网络类型默认与主实例相同，不支持设置。

6.  单击**立即购买**，完成支付即可。

    **说明：** 如果提示`Source InstanceId already bound to a replica`，请使用其他主实例。


## 切换到灾备实例 {#section_xq2_1gf_z2b .section}

您可以手动发起计划内的切换，将业务从主实例切换到灾备实例。以下为手动切换的步骤。

**说明：** 后续将支持计划外的自动切换。

**切换后的变化**

-   集群中由灾备实例提供服务，集群状态变为**灾备实例服务中**，灾备实例由只读变为支持读写操作。
-   集群连接地址不变，应用程序无需修改连接配置。
-   主实例会有60秒的连接闪断。

**前提条件**

集群状态为**正常**。

**操作步骤**

1.  登录[RDS管理控制台](http://rdsnext.console.aliyun.com)。
2.  选择**容灾集群**。
3.  找到目标集群，单击集群ID。
4.  在基本信息页面，单击**容灾切换**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609511234_zh-CN.png)

5.  在弹出的对话框中，单击**立即切换**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609511246_zh-CN.png)

6.  为了确保切换后应用（ECS）能访问到RDS，请检查网络路由、ECS安全组、RDS白名单配置，同时刷新应用的DNS缓存（某些应用会自动刷新DNS缓存）。

## 切换回主实例 {#section_wyn_jxj_z2b .section}

当集群中由灾备实例提供服务时，您可以手动将业务从灾备实例切换回主实例。切换后集群连接地址不变，应用程序无需修改连接配置，但会造成约60秒的连接闪断。

**前提条件**

集群状态为**灾备实例服务中**。

**操作步骤**

1.  登录[RDS管理控制台](http://rdsnext.console.aliyun.com)。
2.  选择**容灾集群**。
3.  找到目标集群，单击集群ID。
4.  在基本信息页面，单击**回切**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609611237_zh-CN.png)

5.  在弹出的对话框中，单击**立即切换**。

## 解散集群 {#section_ity_5xk_z2b .section}

解散集群是指取消主实例和灾备实例之间的容灾配对关系，使两个实例都成为独立的实例。解散集群不会删除实例的数据，不会影响实例的运行，也不会造成连接中断。

-   自动解散：集群中的其中一个包年包月实例到期时，集群将自动解散，另一个实例的运行不受影响。
-   手动解散：具体说明如下。

**前提条件**

集群状态为**正常**。

**操作步骤**

1.  登录[RDS管理控制台](http://rdsnext.console.aliyun.com)。
2.  选择**容灾集群**。
3.  找到目标集群，单击集群ID。
4.  在基本信息页面，单击**解散集群**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/19034/156592609611233_zh-CN.png)

5.  在弹出的对话框中，单击**确定**。

